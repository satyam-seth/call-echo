var w=Object.defineProperty;var A=(n,e,t)=>e in n?w(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var s=(n,e,t)=>A(n,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const c of r.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();class p{static async queryPermissionStatus(e){if(!("permissions"in navigator))return console.warn(`Permission '${e}' is not supported by this browser.`),null;try{return(await navigator.permissions.query({name:e})).state}catch(t){return console.error(`Error querying permission '${e}':`,t),null}}static async checkPermission(e){try{const t=await this.queryPermissionStatus(e);return t==="granted"?!0:(t==="prompt"&&console.warn(`Permission '${e}' requires a specific API call to trigger the prompt.`),!1)}catch(t){return console.error(`Error checking permission '${e}':`,t),!1}}static async watchPermissionState(e,t){if(!("permissions"in navigator)){console.warn(`Permission '${e}' is not supported by this browser.`);return}try{const i=await navigator.permissions.query({name:e});t(i.state),i.onchange=()=>{t(i.state)}}catch(i){console.error(`Error watching permission '${e}':`,i)}}}const T=["microphone","camera","geolocation","notifications"];function g(n,e){const t=document.createElement("button");return t.innerText=n,t.addEventListener("click",e),t}function k(n){return g(`Get ${n} permission Status`,async()=>{const e=await p.queryPermissionStatus(n);alert(e?`Permission ${n} status: ${e}`:`Permission ${n} is not supported or an error occurred.`)})}function q(n){return g(`Check have ${n} permission or not`,async()=>{const e=await p.checkPermission(n);alert(e?`Have ${n} permission.`:`Do not have ${n} Permission.`)})}function V(n){return g(`Watch ${n} permission state`,async()=>{await p.watchPermissionState(n,e=>{alert(`Permission ${n} state changed to: ${e}`)})})}function O(){const n=document.createElement("div");n.className="permission-container";const e=document.createElement("h2");return e.innerText="Permission Demo",n.appendChild(e),T.forEach(t=>{const i=document.createElement("div");i.className="permission-section",i.innerHTML=`<h3>${t}</h3>`,i.appendChild(k(t)),i.appendChild(q(t)),i.appendChild(V(t)),n.appendChild(i)}),n}const u=class u{constructor(){s(this,"constraints");s(this,"_mediaStream",null);s(this,"audioInputDevices",[]);s(this,"audioOutputDevices",[]);s(this,"videoInputDevices",[]);s(this,"nextCallbackId",0);s(this,"deviceChangeCallbacks",new Map);this.startListeningToDeviceChanges()}static get instance(){return u._instance||(u._instance=new u),u._instance}async getUserMedia(e){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia is not supported in this browser.");return this.stopMediaStream(),this.constraints=e,this._mediaStream=await navigator.mediaDevices.getUserMedia(this.constraints),this._mediaStream}catch(t){throw console.error("Error accessing media devices.",t),t}}stopMediaStream(){var e;(e=this._mediaStream)==null||e.getTracks().forEach(t=>t.stop()),this._mediaStream=null}toggleTrack(e){var t;(t=this._mediaStream)==null||t.getTracks().forEach(i=>{i.kind===e&&(i.enabled=!i.enabled)})}enableTrack(e){var t;(t=this._mediaStream)==null||t.getTracks().forEach(i=>{i.kind===e&&(i.enabled=!0)})}disableTrack(e){var t;(t=this._mediaStream)==null||t.getTracks().forEach(i=>{i.kind===e&&(i.enabled=!1)})}isTrackEnabled(e){var t;return((t=this._mediaStream)==null?void 0:t.getTracks().some(i=>i.kind===e&&i.enabled))??!1}get mediaStream(){return this._mediaStream}getMediaStreamConstraints(){return this.constraints}async enumerateDevices(){if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)throw new Error("enumerateDevices is not supported in this browser.");try{const e=await navigator.mediaDevices.enumerateDevices();return this.audioInputDevices=e.filter(t=>t.kind==="audioinput"),this.videoInputDevices=e.filter(t=>t.kind==="videoinput"),this.audioOutputDevices=e.filter(t=>t.kind==="audiooutput"),e}catch(e){throw console.error("Error enumerating devices:",e),e}}getAudioInputDevices(){return this.audioInputDevices}getAudioOutputDevices(){return this.audioOutputDevices}getVideoInputDevices(){return this.videoInputDevices}async setInputDevice(e,t){let i=!0,o=!0;this._mediaStream&&(i=this.isTrackEnabled("audio"),o=this.isTrackEnabled("video"));try{const r=await this.getUserMedia(e);i||this.disableTrack("audio"),o||this.disableTrack("video"),t(r)}catch(r){console.error("Error setting update input device:",r)}}async setAudioInputDevice(e,t){const i={...this.constraints,audio:{deviceId:{exact:e}}};try{return await this.setInputDevice(i,t),!0}catch(o){return console.error("Error setting audio input device:",o),!1}}async setVideoInputDevice(e,t){const i={...this.constraints,video:{deviceId:{exact:e}}};try{return await this.setInputDevice(i,t),!0}catch(o){return console.error("Error setting video input device:",o),!1}}async setAudioOutputDevice(e,t){if(typeof e.sinkId<"u"){try{console.log("Setting audio output device to:",t),await e.setSinkId(t)}catch(i){let o=i;i.name==="SecurityError"&&(o=`You need to use HTTPS for selecting audio output device: ${i}`),console.error(o)}return!0}else return console.warn("Browser does not support output device selection."),!1}get currentAudioInputDeviceId(){var e,t;return(t=(e=this._mediaStream)==null?void 0:e.getAudioTracks()[0])==null?void 0:t.getSettings().deviceId}get currentVideoInputDeviceId(){var e,t;return(t=(e=this._mediaStream)==null?void 0:e.getVideoTracks()[0])==null?void 0:t.getSettings().deviceId}registerDeviceChange(e){const t=this.nextCallbackId++;return this.deviceChangeCallbacks.set(t,e),t}unregisterDeviceChange(e){this.deviceChangeCallbacks.delete(e)}notifyDeviceChange(){console.log("Notifying device change callbacks.",this.deviceChangeCallbacks.size);for(const e of this.deviceChangeCallbacks.values())e()}async startListeningToDeviceChanges(){if(!navigator.mediaDevices||!navigator.mediaDevices.addEventListener){console.warn("Device change events are not supported in this browser.");return}navigator.mediaDevices.addEventListener("devicechange",async()=>{if(console.log("Device change detected."),await this.enumerateDevices(),this._mediaStream){const e=this.currentAudioInputDeviceId,t=this.currentVideoInputDeviceId;(e&&!this.audioInputDevices.some(i=>i.deviceId===e)||t&&!this.videoInputDevices.some(i=>i.deviceId===t))&&this.stopMediaStream()}this.notifyDeviceChange()})}};s(u,"_instance");let a=u,m=null;function d(n,e,t,i=!1){const o=document.createElement("button");return o.id=e,o.disabled=i,o.innerText=n,o.addEventListener("click",t),o}function l(n,e){const t=document.querySelector(`#${n}`);t.disabled=e}function D(){l("stop-local-stream-btn",!1)}function I(){const n=document.querySelector("#toggle-audio-btn");n.disabled=!1,n.innerText="Disable Audio"}function P(){const n=document.querySelector("#toggle-audio-btn");n.disabled=!0,n.innerText="Enable Audio"}function B(){const n=document.querySelector("#toggle-video-btn");n.disabled=!1,n.innerText="Disable Video"}function L(){const n=document.querySelector("#toggle-video-btn");n.disabled=!0,n.innerText="Enable Video"}function $(){l("local-stream-video-btn",!0)}function M(){l("local-stream-video-btn",!1)}function x(){l("local-stream-audio-btn",!0)}function _(){l("local-stream-audio-btn",!1)}function U(n){a.instance.toggleTrack("audio");const e=a.instance.isTrackEnabled("audio");n.target.innerText=e?"Disable Audio":"Enable Audio"}function j(){return d("Disable Audio","toggle-audio-btn",U,!0)}function G(n){a.instance.toggleTrack("video");const e=a.instance.isTrackEnabled("video");n.target.innerText=e?"Disable Video":"Enable Video"}function H(){return d("Disable Video","toggle-video-btn",G,!0)}function z(n){const e=document.querySelector("audio");e&&(e.srcObject=n)}function F(n){const e=document.querySelector("video");e&&(e.srcObject=n)}function K(){const n=document.querySelector("video"),e=document.querySelector("audio");n&&(n.srcObject=null,n.remove()),e&&(e.srcObject=null,e.remove())}function y(){const n=document.querySelector(".audio-input-devices-selector-container"),e=document.querySelector(".audio-output-devices-selector-container"),t=document.querySelector(".video-input-devices-selector-container");n==null||n.remove(),e==null||e.remove(),t==null||t.remove()}function R(){return d("Stop local stream","stop-local-stream-btn",async n=>{n.target.disabled=!0,_(),M(),P(),L(),K(),y(),a.instance.stopMediaStream(),J()},!0)}function W(n){const e=document.createElement("video");return e.srcObject=n,e.autoplay=!0,e.controls=!0,e.style.width="100%",e.style.height="100%",e}function Y(n){const e=document.createElement("audio");return e.srcObject=n,e.autoplay=!0,e.controls=!0,e}function h(n,e,t,i){const o=document.createElement("select");return o.id=n,e.forEach(r=>{const c=document.createElement("option");c.value=r.deviceId,c.textContent=r.label||`Device ${r.deviceId}`,c.selected=i!==void 0&&r.deviceId===i,o.appendChild(c)}),o.addEventListener("change",async r=>{const c=r.target.value;await t(c)}),o}function f(n,e){const t=document.createElement("div");t.className="audio-input-devices-selector-container";const i="audio-input-devices-selector",o=document.createElement("label");o.textContent="Audio Input Devices:",o.setAttribute("for",i),t.appendChild(o);const r=h(i,n,async c=>{await a.instance.setAudioInputDevice(c,z)},e);return t.appendChild(r),t}function b(n){const e=document.createElement("div");e.className="audio-output-devices-selector-container";const t="audio-output-devices-selector",i=document.createElement("label");return i.textContent="Audio Output Devices:",i.setAttribute("for",t),e.appendChild(i),e.appendChild(h(t,n,async o=>{const r=document.querySelector("video");r&&await a.instance.setAudioOutputDevice(r,o);const c=document.querySelector("audio");c&&await a.instance.setAudioOutputDevice(c,o)})),e}function S(n,e){const t=document.createElement("div");t.className="video-input-devices-selector-container";const i="video-input-devices-selector",o=document.createElement("label");o.textContent="Video Input Devices:",o.setAttribute("for",i),t.appendChild(o);const r=h(i,n,async c=>{await a.instance.setVideoInputDevice(c,F)},e);return t.appendChild(r),t}function J(){m!==null&&(a.instance.unregisterDeviceChange(m),m=null)}function E(n){m=a.instance.registerDeviceChange(async()=>{if(console.log("Device changed"),a.instance.mediaStream===null){console.info("Media stream is null, getting new stream");const r=await a.instance.getUserMedia({video:!n,audio:!0}),c=document.querySelector("video"),v=document.querySelector("audio");v&&n?(console.info("Updating audio stream to audio element"),v.srcObject=r):c&&(console.info("Updating video stream to video element"),c.srcObject=r)}const e=document.querySelector(".media-container");y();const t=a.instance.getAudioInputDevices(),i=a.instance.getAudioOutputDevices(),o=a.instance.currentAudioInputDeviceId;if(e.append(f(t,o)),e.append(b(i)),!n){const r=a.instance.getVideoInputDevices(),c=a.instance.currentVideoInputDeviceId;e.append(S(r,c))}})}function Q(){return d("Get local video stream","local-stream-video-btn",async n=>{n.target.disabled=!0,x(),D(),I(),B();const e=await a.instance.getUserMedia({video:!0,audio:!0}),t=document.querySelector(".media-container");t.appendChild(W(e)),await a.instance.enumerateDevices();const i=a.instance.getAudioInputDevices(),o=a.instance.getAudioOutputDevices(),r=a.instance.getVideoInputDevices(),c=a.instance.currentAudioInputDeviceId,v=a.instance.currentVideoInputDeviceId;t.append(f(i,c)),t.append(b(o)),t.append(S(r,v)),E(!1)})}function X(){return d("Get local audio stream","local-stream-audio-btn",async n=>{n.target.disabled=!0,$(),D(),I();const e=await a.instance.getUserMedia({audio:!0}),t=document.querySelector(".media-container");t.appendChild(Y(e)),await a.instance.enumerateDevices();const i=a.instance.getAudioInputDevices(),o=a.instance.getAudioOutputDevices(),r=a.instance.currentAudioInputDeviceId;t.append(f(i,r)),t.append(b(o)),E(!0)})}function Z(){const n=document.createElement("div");n.className="media-container";const e=document.createElement("h2");return e.innerText="Media Demo",n.appendChild(e),n.appendChild(Q()),n.appendChild(X()),n.appendChild(R()),n.appendChild(j()),n.appendChild(H()),n}const C=document.querySelector("#app");C.appendChild(O());C.appendChild(Z());
